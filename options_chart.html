
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Options Data Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3/dist/chartjs-plugin-annotation.min.js"></script>
    <style>
        body { background-color: black; color: white; font-family: Arial, sans-serif; padding: 20px; margin: 0; }
        .container { display: flex; gap: 20px; height: 600px; }
        #chartContainer { flex: 1; background-color: #111; }
        .right-panel { display: flex; flex-direction: column; height: 600px; flex: 0 0 300px; }
        .table-container { flex: 0 0 auto; background-color: #111; padding: 10px; overflow-y: auto; }
        .bar-container { flex: 1; background-color: #111; padding: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100px; }
        .legend-buttons { display: flex; justify-content: center; gap: 10px; margin-bottom: 5px; }
        .legend-btn { background: #333; color: white; border: 1px solid #666; padding: 5px 10px; cursor: pointer; font-size: 12px; }
        .legend-btn:hover { background: #444; }
        .legend-btn.active { background: #007bff; border-color: #007bff; }
        #barChart { max-width: 200px; max-height: 80px; }
        table.table-style { 
            border-collapse: collapse; 
            width: 100%; 
            color: white; 
            background-color: #111; 
        }
        table.table-style th, table.table-style td { 
            border: 1px solid #333; 
            padding: 8px; 
            text-align: left; 
        }
        table.table-style th { 
            background-color: #222; 
            font-weight: bold; 
        }
        table.table-style tr:nth-child(even) { background-color: #222; }
        table.table-style tr:hover { background-color: #333; }
        .green-text { color: #00ff00; }
        .red-text { color: #ff0000; }
        .purple-text { color: #9370DB; }
    </style>
</head>
<body>
    <div class="container">
        <div id="chartContainer">
            <canvas id="myChart"></canvas>
        </div>
        <div class="right-panel">
            <div class="table-container">
                
<table class="table-style">
    <thead>
        <tr>
            <th>Label</th>
            <th>QQQ</th>
            <th>NQ</th>
        </tr>
    </thead>
    <tbody>
        
    <tr class="">
        <td>Spot</td>
        <td>617.67</td>
        <td>25536.5</td>
    </tr>
    
    <tr class="green-text">
        <td>PG-OI</td>
        <td>619.0</td>
        <td>25591.5</td>
    </tr>
    
    <tr class="green-text">
        <td>FG-OI</td>
        <td>610.0</td>
        <td>25219.5</td>
    </tr>
    
    <tr class="red-text">
        <td>FR-OI</td>
        <td>612.0</td>
        <td>25302.0</td>
    </tr>
    
    <tr class="red-text">
        <td>NG-OI</td>
        <td>612.0</td>
        <td>25302.0</td>
    </tr>
    
    <tr class="green-text">
        <td>PG-TT</td>
        <td>619.0</td>
        <td>25591.5</td>
    </tr>
    
    <tr class="green-text">
        <td>FG-TT</td>
        <td>618.0</td>
        <td>25550.25</td>
    </tr>
    
    <tr class="red-text">
        <td>FR-TT</td>
        <td>617.0</td>
        <td>25508.75</td>
    </tr>
    
    <tr class="red-text">
        <td>NG-TT</td>
        <td>616.0</td>
        <td>25467.5</td>
    </tr>
    
    <tr class="purple-text">
        <td>ABS-OI</td>
        <td>615.0</td>
        <td>25426.0</td>
    </tr>
    
    <tr class="purple-text">
        <td>ABS-VOL</td>
        <td>618.0</td>
        <td>25550.25</td>
    </tr>
    
    </tbody>
</table>

            </div>
            <div class="bar-container">
                <div class="legend-buttons">
                    <button class="legend-btn active" data-type="vol" onclick="switchTo(this)">GEX-VOL</button>
                    <button class="legend-btn" data-type="oi" onclick="switchTo(this)">GEX-OI</button>
                </div>
                <canvas id="barChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('myChart').getContext('2d');
        const spot = 617.67;
        const data = {
            datasets: [
                {
                    label: 'GEX-OI',
                    data: [{"x": 604, "y": 0}, {"x": 605, "y": 0}, {"x": 606, "y": 0}, {"x": 607, "y": 0}, {"x": 608, "y": 0}, {"x": 609, "y": 0}, {"x": 610, "y": 115077.94945919997}, {"x": 611, "y": 41895.382526999994}, {"x": 612, "y": 0}, {"x": 613, "y": 253301.50093319995}, {"x": 614, "y": 515322.8407340999}, {"x": 615, "y": 1081632.6228456}, {"x": 616, "y": 359523.03851100005}, {"x": 617, "y": 679995.2748528}, {"x": 618, "y": 620727.281199}, {"x": 619, "y": 1123950.3063516}, {"x": 620, "y": 748300.4847504}, {"x": 621, "y": 317808.13298129995}, {"x": 622, "y": 135687.69493559998}, {"x": 623, "y": 9272.8573488}, {"x": 624, "y": 1549.610496}, {"x": 625, "y": 231.03328679999996}, {"x": 626, "y": 33.9162597}, {"x": 627, "y": 0}, {"x": 628, "y": 0}, {"x": 629, "y": 0}, {"x": 630, "y": 0}, {"x": 631, "y": 0}, {"x": 632, "y": 0}, {"x": 633, "y": 0}],
                    type: 'bar',
                    backgroundColor: '#007bff',
                    stack: 'gex-oi',
                    borderColor: '#007bff',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: '',
                    data: [{"x": 604, "y": -13314.395692799999}, {"x": 605, "y": -30758.082106499995}, {"x": 606, "y": -17198.119351800004}, {"x": 607, "y": -27867.19502879999}, {"x": 608, "y": -29493.915447600008}, {"x": 609, "y": -25485.56451269999}, {"x": 610, "y": 0}, {"x": 611, "y": 0}, {"x": 612, "y": -305979.99954929994}, {"x": 613, "y": 0}, {"x": 614, "y": 0}, {"x": 615, "y": 0}, {"x": 616, "y": 0}, {"x": 617, "y": 0}, {"x": 618, "y": 0}, {"x": 619, "y": 0}, {"x": 620, "y": 0}, {"x": 621, "y": 0}, {"x": 622, "y": 0}, {"x": 623, "y": 0}, {"x": 624, "y": 0}, {"x": 625, "y": 0}, {"x": 626, "y": 0}, {"x": 627, "y": 0}, {"x": 628, "y": 0}, {"x": 629, "y": 0}, {"x": 630, "y": 0}, {"x": 631, "y": 0}, {"x": 632, "y": 0}, {"x": 633, "y": 0}],
                    type: 'bar',
                    backgroundColor: '#dc3545',
                    stack: 'gex-oi',
                    borderColor: '#dc3545',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: '',
                    data: [{"x": 604, "y": 22338.257911200002}, {"x": 605, "y": 76196.08621169999}, {"x": 606, "y": 34899.84976140001}, {"x": 607, "y": 60981.22493279999}, {"x": 608, "y": 88273.813914}, {"x": 609, "y": 82310.80920389999}, {"x": 610, "y": 388636.481592}, {"x": 611, "y": 194300.29130579997}, {"x": 612, "y": 653500.5363873}, {"x": 613, "y": 347494.59469799994}, {"x": 614, "y": 620320.3169660999}, {"x": 615, "y": 1376748.3321143999}, {"x": 616, "y": 427854.74645160005}, {"x": 617, "y": 753466.8742847999}, {"x": 618, "y": 686874.9944933999}, {"x": 619, "y": 1125340.2862127998}, {"x": 620, "y": 882383.5471463999}, {"x": 621, "y": 318466.0380050999}, {"x": 622, "y": 135687.69493559998}, {"x": 623, "y": 9272.8573488}, {"x": 624, "y": 1549.610496}, {"x": 625, "y": 231.03328679999996}, {"x": 626, "y": 33.9162597}, {"x": 627, "y": 0.0}, {"x": 628, "y": 0.0}, {"x": 629, "y": 0.0}, {"x": 630, "y": 0.0}, {"x": 631, "y": 0.0}, {"x": 632, "y": 0.0}, {"x": 633, "y": 0.0}],
                    type: 'line',
                    borderColor: '#6f42c1',
                    backgroundColor: '#6f42c1',
                    fill: false,
                    tension: 0.1,
                    yAxisID: 'y1',
                    borderWidth: 2
                },
                {
                    label: 'GEX-VOL',
                    data: [{"x": 604, "y": 0}, {"x": 605, "y": 0}, {"x": 606, "y": 0}, {"x": 607, "y": 0}, {"x": 608, "y": 0}, {"x": 609, "y": 0}, {"x": 610, "y": 0}, {"x": 611, "y": 0}, {"x": 612, "y": 0}, {"x": 613, "y": 0}, {"x": 614, "y": 0}, {"x": 615, "y": 0}, {"x": 616, "y": 0}, {"x": 617, "y": 0}, {"x": 618, "y": 12348315.822342599}, {"x": 619, "y": 13302636.553106997}, {"x": 620, "y": 8809991.979649197}, {"x": 621, "y": 1322389.8946323}, {"x": 622, "y": 296550.902574}, {"x": 623, "y": 36552.4258464}, {"x": 624, "y": 2285.8731359999997}, {"x": 625, "y": 286.9200684}, {"x": 626, "y": 20.685768300000003}, {"x": 627, "y": 0}, {"x": 628, "y": 0}, {"x": 629, "y": 0}, {"x": 630, "y": 0}, {"x": 631, "y": 0}, {"x": 632, "y": 0}, {"x": 633, "y": 0}],
                    type: 'bar',
                    backgroundColor: '#007bff',
                    stack: 'gex-vol',
                    borderColor: '#007bff',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: '',
                    data: [{"x": 604, "y": -14105.8286172}, {"x": 605, "y": -62251.5806451}, {"x": 606, "y": -35034.674769000005}, {"x": 607, "y": -42095.64349439999}, {"x": 608, "y": -112251.02210999999}, {"x": 609, "y": -104444.87776649997}, {"x": 610, "y": -529345.0183032}, {"x": 611, "y": -285633.7459182}, {"x": 612, "y": -1374097.033053}, {"x": 613, "y": -1581659.0328006002}, {"x": 614, "y": -2746797.6130632}, {"x": 615, "y": -5552421.1286544}, {"x": 616, "y": -5915977.6510926}, {"x": 617, "y": -3461485.3858584054}, {"x": 618, "y": 0}, {"x": 619, "y": 0}, {"x": 620, "y": 0}, {"x": 621, "y": 0}, {"x": 622, "y": 0}, {"x": 623, "y": 0}, {"x": 624, "y": 0}, {"x": 625, "y": 0}, {"x": 626, "y": 0}, {"x": 627, "y": 0}, {"x": 628, "y": 0}, {"x": 629, "y": 0}, {"x": 630, "y": 0}, {"x": 631, "y": 0}, {"x": 632, "y": 0}, {"x": 633, "y": 0}],
                    type: 'bar',
                    backgroundColor: '#dc3545',
                    stack: 'gex-vol',
                    borderColor: '#dc3545',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: '',
                    data: [{"x": 604, "y": 16085.683328400002}, {"x": 605, "y": 74119.2449571}, {"x": 606, "y": 50254.0388622}, {"x": 607, "y": 81600.630768}, {"x": 608, "y": 155085.10244279998}, {"x": 609, "y": 150153.24838409998}, {"x": 610, "y": 760381.6158144}, {"x": 611, "y": 454735.97956619994}, {"x": 612, "y": 1660666.5366678}, {"x": 613, "y": 2134155.3850962003}, {"x": 614, "y": 3974552.1930942}, {"x": 615, "y": 10357648.439544}, {"x": 616, "y": 17919581.012658}, {"x": 617, "y": 42366472.46868241}, {"x": 618, "y": 45149285.863542594}, {"x": 619, "y": 22310500.327889394}, {"x": 620, "y": 12620891.3697306}, {"x": 621, "y": 1449088.5515841}, {"x": 622, "y": 296550.902574}, {"x": 623, "y": 36552.4258464}, {"x": 624, "y": 2285.8731359999997}, {"x": 625, "y": 286.9200684}, {"x": 626, "y": 20.685768300000003}, {"x": 627, "y": 0.0}, {"x": 628, "y": 0.0}, {"x": 629, "y": 0.0}, {"x": 630, "y": 0.0}, {"x": 631, "y": 0.0}, {"x": 632, "y": 0.0}, {"x": 633, "y": 0.0}],
                    type: 'line',
                    borderColor: '#8b5cf6',
                    backgroundColor: '#8b5cf6',
                    fill: false,
                    tension: 0.1,
                    yAxisID: 'y1',
                    borderWidth: 2
                }
            ]
        };

        const config = {
            type: 'bar',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            filter: function(legendItem) {
                                return legendItem.text !== '';
                            },
                            color: 'white',
                            usePointStyle: true
                        },
                        onClick: function(e, legendItem, legend) {
                            const ci = this.chart;
                            const index = legendItem.datasetIndex;
                            if (index === 0) { // GEX-OI
                                [0,1,2].forEach(idx => ci.getDatasetMeta(idx).hidden = false);
                                [3,4,5].forEach(idx => ci.getDatasetMeta(idx).hidden = true);
                                // Switch gauge to OI
                                currentValue = gexOiValue;
                                barChart.options.currentValue = currentValue;
                                const barColor = currentValue >= 0 ? '#00ff00' : '#ff0000';
                                barChart.data.datasets[0].data[0] = currentValue;
                                barChart.data.datasets[0].backgroundColor[0] = barColor;
                                barChart.update('none');
                                document.querySelectorAll('.legend-btn').forEach(b => b.classList.remove('active'));
                                document.querySelector('[data-type="oi"]').classList.add('active');
                            } else if (index === 3) { // GEX-VOL
                                [3,4,5].forEach(idx => ci.getDatasetMeta(idx).hidden = false);
                                [0,1,2].forEach(idx => ci.getDatasetMeta(idx).hidden = true);
                                // Switch gauge to VOL
                                currentValue = gexVolValue;
                                barChart.options.currentValue = currentValue;
                                const barColor = currentValue >= 0 ? '#00ff00' : '#ff0000';
                                barChart.data.datasets[0].data[0] = currentValue;
                                barChart.data.datasets[0].backgroundColor[0] = barColor;
                                barChart.update('none');
                                document.querySelectorAll('.legend-btn').forEach(b => b.classList.remove('active'));
                                document.querySelector('[data-type="vol"]').classList.add('active');
                            }
                            ci.update();
                        }
                    },
                    annotation: {
                        annotations: {
                            spotLine: {
                                type: 'line',
                                scaleID: 'x',
                                value: spot,
                                borderColor: 'white',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                label: {
                                    display: true,
                                    content: 'Spot ' + spot,
                                    position: 'top'
                                }
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'linear',
                        stacked: true,
                        ticks: {
                            color: 'white',
                            stepSize: 1,
                            maxRotation: 45
                        },
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        stacked: true,
                        ticks: {
                            color: 'white',
                            callback: function(value) {
                                return value.toLocaleString();
                            }
                        },
                        grid: {
                            display: false
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        stacked: false,
                        ticks: {
                            color: 'white',
                            callback: function(value) {
                                return value.toLocaleString();
                            },
                            maxTicksLimit: 10
                        },
                        grid: {
                            display: false
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        };

        const myChart = new Chart(ctx, config);

        // Initially hide GEX-OI group to show only GEX-VOL
        [0,1,2].forEach(idx => myChart.getDatasetMeta(idx).hidden = true);
        myChart.update();

        // Horizontal Bar Chart for Gauge
        const gexOiValue = 86.05302523373592;
        const gexVolValue = 24.684608859265282;
        let currentValue = gexVolValue;
        const barCtx = document.getElementById('barChart').getContext('2d');
        const initialBarColor = currentValue >= 0 ? '#00ff00' : '#ff0000';
        const barData = {
            labels: [''],
            datasets: [
                {
                    data: [currentValue],
                    backgroundColor: [initialBarColor],
                    borderWidth: 0
                }
            ]
        };

        const barConfig = {
            type: 'bar',
            data: barData,
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                currentValue: currentValue,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        min: -100,
                        max: 100,
                        ticks: {
                            color: 'white',
                            stepSize: 100,
                            callback: function(value) {
                                return value + '%';
                            }
                        },
                        grid: {
                            color: '#333'
                        }
                    },
                    y: {
                        ticks: {
                            color: 'white',
                            display: false
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            },
            plugins: [
                {
                    id: 'customValueLabel',
                    afterDraw: function(chart) {
                        const ctx = chart.ctx;
                        const value = chart.options.currentValue;
                        const meta = chart.getDatasetMeta(0);
                        const bar = meta.data[0];
                        const x = bar.x + (bar.width / 2);
                        const y = bar.y;
                        ctx.save();
                        ctx.font = 'bold 12px Arial';
                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(value.toFixed(1) + '%', x, y);
                        ctx.restore();
                    }
                }
            ]
        };

        const barChart = new Chart(barCtx, barConfig);

        function switchTo(btn) {
            const type = btn.dataset.type;
            currentValue = type === 'oi' ? gexOiValue : gexVolValue;
            barChart.options.currentValue = currentValue;
            const barColor = currentValue >= 0 ? '#00ff00' : '#ff0000';
            barChart.data.datasets[0].data[0] = currentValue;
            barChart.data.datasets[0].backgroundColor[0] = barColor;
            barChart.update('none');
            document.querySelectorAll('.legend-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            // Sync main chart
            if(type === 'oi'){
                [0,1,2].forEach(idx => myChart.getDatasetMeta(idx).hidden = false);
                [3,4,5].forEach(idx => myChart.getDatasetMeta(idx).hidden = true);
            } else {
                [3,4,5].forEach(idx => myChart.getDatasetMeta(idx).hidden = false);
                [0,1,2].forEach(idx => myChart.getDatasetMeta(idx).hidden = true);
            }
            myChart.update();
        }
    </script>
</body>
</html>
